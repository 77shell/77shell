#!/bin/bash

if ! make; then
    exit 1
fi

if ! make test; then
    exit 1
fi

if ! [ -f /dev/cdata ]; then
    mknod /dev/cdata c 121 0
    #echo -e "\033[32mNo device node\033[0m"
fi

rmmod cdata


if ! insmod cdata.ko; then
    exit 1
fi

./test
dmesg | tail -n 18
